using Test, Hyperopt

data = [[0.75762386,6.0,8.0,],
[0.40709311,2.0,8.0,],
[0.73019489,1.0,7.0,],
[0.9350646,1.0,8.0,],
[0.20622478,7.0,3.0,],
[0.82868765,4.0,9.0,],
[0.83275865,6.0,5.0,],
[0.06151981,6.0,5.0,],
[0.47064985,2.0,0.0,],
[0.81312999,5.0,4.0,],
[0.60976384,5.0,0.0,],
[0.58597128,0.0,9.0,],
[0.97580821,5.0,9.0,],
[0.21986135,2.0,4.0,],
[0.33835384,6.0,6.0,],
[0.52131305,9.0,8.0,],
[0.0651185,6.0,9.0,],
[0.75884609,9.0,3.0,],
[0.59935732,5.0,4.0,],
[0.88377118,6.0,3.0,],]
data_pred = [[0.11249392,4.0,6.0,],
[0.28704927,5.0,3.0,],
[0.06442488,1.0,6.0,],
[0.88971842,6.0,9.0,],
[0.58269063,5.0,2.0,],
[0.04070221,3.0,4.0,],
[0.33534097,2.0,3.0,],
[0.25188701,3.0,9.0,],
[0.54533024,5.0,9.0,],
[0.51731902,2.0,2.0,],
[0.40469525,5.0,1.0,],
[0.34114321,8.0,4.0,],
[0.39484506,7.0,9.0,],
[0.45614159,6.0,3.0,],
[0.01384118,2.0,2.0,],
[0.09847895,3.0,5.0,],
[0.95260732,8.0,3.0,],
[0.92190954,2.0,1.0,],
[0.10851023,7.0,7.0,],
[0.41038077,2.0,3.0,],]
# output of statsmodels given above input
expected_result = [
    [4.014556252605015e-07,4.93587849306923e-07,5.017127433753062e-05,4.297840888944418,1.4103686336015966,0.0004239071556898233,0.0002450830674101923,0.001520097546290904,1.6695504130319276e-05,9.585990125997658e-05,0.0024919490954259764,0.024667731573921547,1.2143707817645687e-05,8.952814734339356e-05,3.470292679120249e-09,9.825400944075402e-06,0.00017389979047319838,0.10795426189791625,2.5029651369084925e-05,4.859412084689039,],
    [0.006731618223323871,0.034852108047552656,0.0008987511262355018,0.26494502607810944,0.002093798643830388,0.04134463379287447,0.001734435606041325,0.034237993437472795,0.34814274656951194,0.0014581092899801078,0.002014698187056216,0.002549489235012434,0.03711991361931681,0.32252782622899556,0.0013659916119672653,0.0024460021110439176,0.06131450492717148,0.0012846078414541185,0.000750247341719304,0.0017450935407583167,],
    [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,],
    [0.07012047583564995,0.16682618301528643,0.04595196932831633,0.26088694468743184,0.15452574048888829,0.09336064500373596,0.11310195315610574,0.09485512130103643,0.3361451517102332,0.10902096724118503,0.13788547837516862,0.05885101643100109,0.1329887267194227,0.3387753430435409,0.0787994864890616,0.052985136882964974,0.10988250614008524,0.07668631403187032,0.06941533271304429,0.11576170881780576,],
]
dims = [Continuous(), Categorical(10), UnorderedCategorical(10)]
bws = [[0.01, 0.1, 1], [1, 0.2, 0.01], [0.02, 1, 1], [0.5, 0.5, 0.5]]

@testset "multi_kde" begin
    result = Hyperopt.RealVectorVector()
    for bandwidth in bws
        multi_kde = Hyperopt.MultivariateKDE(dims, bandwidth, data)
        _result = [Hyperopt.pdf(multi_kde, _data) for _data in data_pred]
        push!(result, _result)
    end
    @test sum(result .â‰ˆ expected_result) == length(expected_result)
end